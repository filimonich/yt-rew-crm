import{_ as L,v as j}from"./v4.psNbBq1n.js";import{_ as G}from"./index.BYSmW1qp.js";import{u as Q}from"./index.Ch9xVUq6.js";import{f as z,g as H,h as J,i as W,j as X,o as I,c as w,a as l,t as C,k as t,b as o,m as _,l as f,n as Y,w as Z,d as ee,p as te,e as ae,_ as se}from"./entry.gr-FopAl.js";import{u as oe,a as F}from"./vee-validate.esm.iti4QgyW.js";import{D as B,a as D,C as U,s as E,S as M}from"./appwrite.DjCiGi0b.js";import{u as le}from"./useQuery.BdH6XiN5.js";const ne=n=>(te("data-v-cc996cc9"),n=n(),ae(),n),ue={class:"p-10"},re={class:"font-bold text-2xl mb-10"},ie=["src"],me={class:"grid w-full max-w-sm items-center gap-1.5 input"},de=ne(()=>l("div",{class:"text-sm mb-6"},"Логотип",-1)),ce=z({__name:"[id]",setup(n){Q({title:"Редактирование компании | CRM System"});const u=H().params.id,{handleSubmit:N,defineField:i,setFieldValue:g,setValues:R,values:v}=oe({}),{data:m,isSuccess:k}=le({queryKey:["get customer",u],queryFn:()=>B.getDocument(D,U,u)}),O=e=>{R({email:e.email,avatar_url:e.avatar_url,from_source:e.from_source||"",name:e.name})};J(()=>{W(()=>{k.value&&O(m.value)})}),X(()=>{var e;return(e=m.value)==null?void 0:e.avatar_url},e=>{e&&g("avatar_url",e)},{immediate:!0});const[d,P]=i("name"),[c,T]=i("email"),[p,A]=i("from_source"),{mutate:K,isPending:S}=F({mutationKey:["update customer",u],mutationFn:e=>B.updateDocument(D,U,u,e)}),{mutate:$,isPending:h}=F({mutationKey:["upload image"],mutationFn:e=>E.createFile(M,j(),e),onSuccess(e){const s=E.getFileDownload(M,e.$id);g("avatar_url",s.href)}}),V=N(e=>{K(e)});return(e,s)=>{var y;const r=L,q=G;return I(),w("div",ue,[l("h1",re," Редактирование компании "+C((y=t(m))==null?void 0:y.name),1),l("form",{onSubmit:s[3]||(s[3]=(...a)=>t(V)&&t(V)(...a)),class:"form"},[o(r,_({placeholder:"Название компании",modelValue:t(d),"onUpdate:modelValue":s[0]||(s[0]=a=>f(d)?d.value=a:null)},t(P),{type:"text",class:"input"}),null,16,["modelValue"]),o(r,_({placeholder:"Почта",modelValue:t(c),"onUpdate:modelValue":s[1]||(s[1]=a=>f(c)?c.value=a:null)},t(T),{type:"text",class:"input"}),null,16,["modelValue"]),o(r,_({placeholder:"Откуда пришла",modelValue:t(p),"onUpdate:modelValue":s[2]||(s[2]=a=>f(p)?p.value=a:null)},t(A),{type:"text",class:"input"}),null,16,["modelValue"]),t(v).avatar_url||t(h)?(I(),w("img",{key:0,src:t(v).avatar_url,alt:"",width:"50",height:"50",class:"rounded-full my-4"},null,8,ie)):Y("",!0),l("div",me,[l("label",null,[de,o(r,{type:"file",onchange:a=>{var b,x;return((x=(b=a==null?void 0:a.target)==null?void 0:b.files)==null?void 0:x.length)&&t($)(a.target.files[0])},disabled:t(h)},null,8,["onchange","disabled"])])]),o(q,{disabled:t(S),variant:"secondary",class:"mt-2"},{default:Z(()=>[ee(C(t(S)?"Загрузка...":"Сохранить"),1)]),_:1},8,["disabled"])],32)])}}}),ye=se(ce,[["__scopeId","data-v-cc996cc9"]]);export{ye as default};
